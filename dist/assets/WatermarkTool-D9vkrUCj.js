import{r,j as t}from"./index-HKiqIxh0.js";import{P as q,r as W}from"./PDFButton-CDUsgRP_.js";function Q(){const[S,A]=r.useState(null),[i,F]=r.useState("text"),[y,B]=r.useState("Sample Watermark"),[d,L]=r.useState(.25),[R,z]=r.useState(30),[p,O]=r.useState(1),[j,E]=r.useState(!1),[T,X]=r.useState(null),[C,Y]=r.useState(null),[P,D]=r.useState(!1),U=r.useRef(null);r.useEffect(()=>{J()},[y,C,d,R,p,j,i]);async function M(e){var s;const a=(s=e.target.files)==null?void 0:s[0];a&&A(a)}async function $(e){var l;const a=(l=e.target.files)==null?void 0:l[0];if(!a)return;X(a);const s=new FileReader;s.onload=()=>Y(s.result),s.readAsDataURL(a)}function H(e,a,s){e.clearRect(0,0,a,s),e.save(),e.globalAlpha=Number(d),e.translate(a/2,s/2),e.rotate(R*Math.PI/180);const l=Number(p)||1;if(i==="text")if(e.font=`${48*l}px sans-serif`,e.fillStyle="#444",e.textAlign="center",e.textBaseline="middle",j){const n=300*l,g=200*l;for(let o=-s;o<s*2;o+=g)for(let x=-a;x<a*2;x+=n)e.save(),e.translate(x,o),e.fillText(y,0,0),e.restore()}else e.fillText(y,0,0);else if(i==="image"&&C){const n=new Image;n.src=C,n.onload=()=>{const g=n.naturalWidth*l,o=n.naturalHeight*l;if(j){const x=g+60,N=o+60;for(let h=-s;h<s*2;h+=N)for(let c=-a;c<a*2;c+=x)e.drawImage(n,c,h,g,o)}else e.drawImage(n,-g/2,-o/2,g,o)}}e.restore()}function J(){const e=U.current;if(!e)return;const a=e.getContext("2d"),s=e.width,l=e.height;a.fillStyle="#fff",a.fillRect(0,0,s,l),a.strokeStyle="#ddd",a.strokeRect(10,10,s-20,l-20),a.save(),a.translate(s/2,l/2),H(a,s,l),a.restore()}async function _(){if(!S)return alert("Select a PDF");D(!0);try{const e=await S.arrayBuffer(),a=await q.load(e),s=a.getPages();let l=null,n=null,g=!1;i==="image"&&T&&(l=await T.arrayBuffer(),g=(T.type||"").toLowerCase().includes("png"),g?n=await a.embedPng(l):n=await a.embedJpg(l));for(const c of s){const{width:v,height:k}=c.getSize();if(i==="text"){const m=48*Number(p||1),I={x:v/2,y:k/2,size:m,color:W(.4,.4,.4),rotate:void 0,opacity:Number(d),xSkew:0};if(j){const f=300*Number(p||1),u=200*Number(p||1);for(let b=-u;b<k+u;b+=u)for(let w=-f;w<v+f;w+=f)c.drawText(y,{x:w+f/2,y:b+u/2,size:m,color:W(.4,.4,.4),opacity:Number(d)})}else c.drawText(y,{x:v/2-y.length*m*.12,y:k/2,size:m,color:W(.4,.4,.4),opacity:Number(d)})}else if(i==="image"&&n){const m=n.width*Number(p||1),I=n.height*Number(p||1);if(j){const f=m+40,u=I+40;for(let b=-u;b<k+u;b+=u)for(let w=-f;w<v+f;w+=f)c.drawImage(n,{x:w,y:b,width:m,height:I,opacity:Number(d)})}else c.drawImage(n,{x:v/2-m/2,y:k/2-I/2,width:m,height:I,opacity:Number(d)})}}const o=await a.save(),x=new Blob([o],{type:"application/pdf"}),N=URL.createObjectURL(x),h=document.createElement("a");h.href=N,h.download=S.name.replace(/\.pdf$/i,"")+"_watermarked.pdf",h.click(),URL.revokeObjectURL(N)}catch(e){console.error(e),alert("Failed: "+(e.message||e))}finally{D(!1)}}return t.jsxs("div",{children:[t.jsx("h2",{children:"Watermark PDF"}),t.jsx("div",{children:t.jsx("input",{type:"file",accept:"application/pdf",onChange:M})}),t.jsxs("div",{style:{marginTop:12,display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"},children:[t.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx("input",{type:"radio",name:"mode",value:"text",checked:i==="text",onChange:()=>F("text")})," Text"]}),t.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx("input",{type:"radio",name:"mode",value:"image",checked:i==="image",onChange:()=>F("image")})," Image"]}),i==="image"&&t.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:["Image: ",t.jsx("input",{type:"file",accept:"image/*",onChange:$})]})]}),i==="text"&&t.jsx("div",{style:{marginTop:8},children:t.jsx("input",{value:y,onChange:e=>B(e.target.value),style:{width:"60%"}})}),t.jsxs("div",{style:{marginTop:8,display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"},children:[t.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:["Opacity",t.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:d,onChange:e=>L(Number(e.target.value))}),t.jsxs("div",{style:{width:48,textAlign:"right"},children:[Math.round(d*100),"%"]})]}),t.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:["Rotation",t.jsx("input",{type:"number",value:R,onChange:e=>z(Number(e.target.value)),style:{width:80}})]}),t.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:["Scale",t.jsx("input",{type:"range",min:"0.1",max:"3",step:"0.05",value:p,onChange:e=>O(Number(e.target.value))}),t.jsxs("div",{style:{width:48,textAlign:"right"},children:[p.toFixed(2),"x"]})]}),t.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx("input",{type:"checkbox",checked:j,onChange:e=>E(e.target.checked)})," Tiling"]})]}),t.jsxs("div",{style:{marginTop:12},children:[t.jsx("div",{className:"muted",children:"Preview"}),t.jsx("canvas",{"aria-label":"Watermark preview",ref:U,width:600,height:800,style:{width:"100%",maxWidth:600,display:"block",border:"1px solid #ddd",background:"#fff"}})]}),t.jsx("div",{style:{marginTop:12},children:t.jsx("button",{className:"btn-primary",onClick:_,disabled:P||!S,children:P?"Working...":"Apply Watermark"})})]})}export{Q as default};
