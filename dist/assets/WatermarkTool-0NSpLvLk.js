import{r,j as a}from"./index-D_qvBJzx.js";import{P as _,r as P}from"./PDFButton-D8tUxpMY.js";function K(){const[I,A]=r.useState(null),[i,W]=r.useState("text"),[y,B]=r.useState("Sample Watermark"),[d,E]=r.useState(.25),[C,L]=r.useState(30),[p,z]=r.useState(1),[w,O]=r.useState(!1),[R,X]=r.useState(null),[T,Y]=r.useState(null),[F,D]=r.useState(!1),U=r.useRef(null);r.useEffect(()=>{H()},[y,T,d,C,p,w,i]);async function M(e){var s;const t=(s=e.target.files)==null?void 0:s[0];t&&A(t)}async function V(e){var n;const t=(n=e.target.files)==null?void 0:n[0];if(!t)return;X(t);const s=new FileReader;s.onload=()=>Y(s.result),s.readAsDataURL(t)}function $(e,t,s){e.clearRect(0,0,t,s),e.save(),e.globalAlpha=Number(d),e.translate(t/2,s/2),e.rotate(C*Math.PI/180);const n=Number(p)||1;if(i==="text"){e.font=`${48*n}px sans-serif`;try{const l=getComputedStyle(document.documentElement);e.fillStyle=l.getPropertyValue("--muted")||"#444"}catch{e.fillStyle="#444"}if(e.textAlign="center",e.textBaseline="middle",w){const l=300*n,g=200*n;for(let o=-s;o<s*2;o+=g)for(let x=-t;x<t*2;x+=l)e.save(),e.translate(x,o),e.fillText(y,0,0),e.restore()}else e.fillText(y,0,0)}else if(i==="image"&&T){const l=new Image;l.src=T,l.onload=()=>{const g=l.naturalWidth*n,o=l.naturalHeight*n;if(w){const x=g+60,N=o+60;for(let h=-s;h<s*2;h+=N)for(let c=-t;c<t*2;c+=x)e.drawImage(l,c,h,g,o)}else e.drawImage(l,-g/2,-o/2,g,o)}}e.restore()}function H(){const e=U.current;if(!e)return;const t=e.getContext("2d"),s=e.width,n=e.height;try{const l=getComputedStyle(document.documentElement);t.fillStyle=l.getPropertyValue("--paper")||"#fff",t.strokeStyle=l.getPropertyValue("--border")||"#ddd"}catch{t.fillStyle="#fff",t.strokeStyle="#ddd"}t.fillRect(0,0,s,n),t.strokeRect(10,10,s-20,n-20),t.save(),t.translate(s/2,n/2),$(t,s,n),t.restore()}async function J(){if(!I)return alert("Select a PDF");D(!0);try{const e=await I.arrayBuffer(),t=await _.load(e),s=t.getPages();let n=null,l=null,g=!1;i==="image"&&R&&(n=await R.arrayBuffer(),g=(R.type||"").toLowerCase().includes("png"),g?l=await t.embedPng(n):l=await t.embedJpg(n));for(const c of s){const{width:j,height:S}=c.getSize();if(i==="text"){const m=48*Number(p||1),k={x:j/2,y:S/2,size:m,color:P(.4,.4,.4),rotate:void 0,opacity:Number(d),xSkew:0};if(w){const u=300*Number(p||1),f=200*Number(p||1);for(let b=-f;b<S+f;b+=f)for(let v=-u;v<j+u;v+=u)c.drawText(y,{x:v+u/2,y:b+f/2,size:m,color:P(.4,.4,.4),opacity:Number(d)})}else c.drawText(y,{x:j/2-y.length*m*.12,y:S/2,size:m,color:P(.4,.4,.4),opacity:Number(d)})}else if(i==="image"&&l){const m=l.width*Number(p||1),k=l.height*Number(p||1);if(w){const u=m+40,f=k+40;for(let b=-f;b<S+f;b+=f)for(let v=-u;v<j+u;v+=u)c.drawImage(l,{x:v,y:b,width:m,height:k,opacity:Number(d)})}else c.drawImage(l,{x:j/2-m/2,y:S/2-k/2,width:m,height:k,opacity:Number(d)})}}const o=await t.save(),x=new Blob([o],{type:"application/pdf"}),N=URL.createObjectURL(x),h=document.createElement("a");h.href=N,h.download=I.name.replace(/\.pdf$/i,"")+"_watermarked.pdf",h.click(),URL.revokeObjectURL(N)}catch(e){console.error(e),alert("Failed: "+(e.message||e))}finally{D(!1)}}return a.jsxs("div",{children:[a.jsx("h2",{children:"Watermark PDF"}),a.jsx("div",{children:a.jsx("input",{type:"file",accept:"application/pdf",onChange:M})}),a.jsxs("div",{style:{marginTop:12,display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"},children:[a.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[a.jsx("input",{type:"radio",name:"mode",value:"text",checked:i==="text",onChange:()=>W("text")})," Text"]}),a.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[a.jsx("input",{type:"radio",name:"mode",value:"image",checked:i==="image",onChange:()=>W("image")})," Image"]}),i==="image"&&a.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:["Image: ",a.jsx("input",{type:"file",accept:"image/*",onChange:V})]})]}),i==="text"&&a.jsx("div",{style:{marginTop:8},children:a.jsx("input",{value:y,onChange:e=>B(e.target.value),style:{width:"60%"}})}),a.jsxs("div",{style:{marginTop:8,display:"flex",gap:12,alignItems:"center",flexWrap:"wrap"},children:[a.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:["Opacity",a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:d,onChange:e=>E(Number(e.target.value))}),a.jsxs("div",{style:{width:48,textAlign:"right"},children:[Math.round(d*100),"%"]})]}),a.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:["Rotation",a.jsx("input",{type:"number",value:C,onChange:e=>L(Number(e.target.value)),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:["Scale",a.jsx("input",{type:"range",min:"0.1",max:"3",step:"0.05",value:p,onChange:e=>z(Number(e.target.value))}),a.jsxs("div",{style:{width:48,textAlign:"right"},children:[p.toFixed(2),"x"]})]}),a.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:[a.jsx("input",{type:"checkbox",checked:w,onChange:e=>O(e.target.checked)})," Tiling"]})]}),a.jsxs("div",{style:{marginTop:12},children:[a.jsx("div",{className:"muted",children:"Preview"}),a.jsx("canvas",{"aria-label":"Watermark preview",ref:U,width:600,height:800,style:{width:"100%",maxWidth:600,display:"block",border:"1px solid var(--border)",background:"var(--paper)"}})]}),a.jsx("div",{style:{marginTop:12},children:a.jsx("button",{className:"btn-primary",onClick:J,disabled:F||!I,children:F?"Working...":"Apply Watermark"})})]})}export{K as default};
