import{r as l,j as o}from"./index-HKiqIxh0.js";import{p as u}from"./pdf-DLgImPGD.js";import{P as R}from"./PDFButton-CDUsgRP_.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";try{u.GlobalWorkerOptions.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${u.version}/pdf.worker.min.js`}catch{}function M(){const[g,w]=l.useState(null),[d,x]=l.useState(null),i=l.useRef(),[j,h]=l.useState(!1);async function v(t){const e=t.target.files[0];if(!e)return;w(e);const n=await e.arrayBuffer(),r=await(await u.getDocument({data:n}).promise).getPage(1),a=r.getViewport({scale:1.5}),c=document.createElement("canvas");c.width=Math.ceil(a.width),c.height=Math.ceil(a.height);const p=c.getContext("2d");await r.render({canvasContext:p,viewport:a}).promise,x(c.toDataURL("image/png"))}l.useEffect(()=>{const t=i.current;if(!t||!d)return;const e=t.getContext("2d"),n=new Image;n.onload=()=>{t.width=n.width,t.height=n.height,e.drawImage(n,0,0)},n.src=d},[d]);function y(t){h(!0),m(t)}function b(){h(!1)}function m(t){if(!j)return;const e=i.current,n=e.getBoundingClientRect(),s=t.clientX-n.left,r=t.clientY-n.top,a=e.getContext("2d");a.fillStyle="rgba(255,0,0,0.6)",a.beginPath(),a.arc(s,r,6,0,Math.PI*2),a.fill()}async function P(){if(!g||!i.current)return;const t=await new Promise(D=>i.current.toBlob(D,"image/png")),e=await R.create(),n=await t.arrayBuffer(),s=await e.embedPng(n);e.addPage([s.width,s.height]).drawImage(s,{x:0,y:0,width:s.width,height:s.height});const a=await e.save(),c=new Blob([a],{type:"application/pdf"}),p=URL.createObjectURL(c),f=document.createElement("a");f.href=p,f.download=g.name.replace(/\.pdf$/i,"")+"_annotated.pdf",f.click(),URL.revokeObjectURL(p)}return o.jsxs("div",{children:[o.jsx("h2",{children:"Annotate PDF (single-page preview)"}),o.jsxs("div",{className:"dropzone",children:[o.jsx("input",{type:"file",accept:"application/pdf",onChange:v}),o.jsx("div",{className:"muted",children:"Load a PDF (first page shown). Draw on canvas to annotate."})]}),d&&o.jsxs("div",{style:{marginTop:12},children:[o.jsx("div",{style:{border:"1px solid #eee"},children:o.jsx("canvas",{ref:i,onMouseDown:y,onMouseUp:b,onMouseMove:m,style:{display:"block",width:"100%"}})}),o.jsx("div",{style:{marginTop:8},children:o.jsx("button",{className:"btn",onClick:P,children:"Export Annotated PDF"})})]})]})}export{M as default};
