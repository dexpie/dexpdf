import{r as u,j as e}from"./index-HKiqIxh0.js";import{p as f}from"./pdf-DLgImPGD.js";import{E as X}from"./jspdf.es.min-CzuLzNqZ.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";try{f.GlobalWorkerOptions.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${f.version}/pdf.worker.min.js`}catch(d){console.warn("pdfjs worker not set",d)}function se(){const[d,B]=u.useState(null),[z,S]=u.useState(0),[D,F]=u.useState(!1),[O,T]=u.useState(!1),[J,R]=u.useState(!1),[v,V]=u.useState(.7),[P,$]=u.useState(.9),[k,U]=u.useState(null),[y,I]=u.useState(null),[m,j]=u.useState(null),[E,C]=u.useState(!1),[Q,g]=u.useState("");async function A(t){var s;const r=(s=t.target.files)==null?void 0:s[0];if(r){B(r),I(r.size);try{const n=await r.arrayBuffer(),c=await f.getDocument({data:n}).promise;S(c.numPages),j(null),g("")}catch(n){console.error(n),alert("Unable to read PDF: "+(n.message||n))}}}function L(t){t.preventDefault(),T(!0)}function Z(t){t.preventDefault(),t.dataTransfer.dropEffect="copy"}function K(t){t.preventDefault(),T(!1)}async function W(t){var s,n;t.preventDefault(),T(!1);const r=(n=(s=t.dataTransfer)==null?void 0:s.files)==null?void 0:n[0];if(r){B(r),I(r.size);const c=await r.arrayBuffer(),a=await f.getDocument({data:c}).promise;S(a.numPages),j(null),g(""),R(!0),setTimeout(()=>R(!1),1500)}}function q(t){return t*25.4/96}async function G({download:t=!0,preview:r=!1}={download:!0,preview:!1}){if(!d)return alert("Select a PDF to compress");if(!(z>80&&!confirm("This PDF has "+z+" pages. Compressing will rasterize pages in the browser and may be slow or use lots of memory. Continue?"))){F(!0),U(null);try{const s=await d.arrayBuffer(),n=await f.getDocument({data:s}).promise,c=n.numPages;let a=null;for(let i=1;i<=c;i++){const o=await n.getPage(i),p=o.getViewport({scale:P}),l=document.createElement("canvas");l.width=Math.ceil(p.width),l.height=Math.ceil(p.height);const x=l.getContext("2d");await o.render({canvasContext:x,viewport:p}).promise;const h=l.toDataURL("image/jpeg",Number(v)),w=q(l.width),M=q(l.height);i===1?(a=new X({unit:"mm",format:[w,M]}),a.addImage(h,"JPEG",0,0,w,M)):(a.addPage([w,M]),a.addImage(h,"JPEG",0,0,w,M)),l.width=0,l.height=0}if(!a)throw new Error("Failed to create compressed PDF");if(r){const i=a.output("datauristring");U(i)}t&&a.save(d.name.replace(/\.pdf$/i,"")+"_compressed.pdf")}catch(s){console.error(s),alert("Compression failed: "+(s.message||s))}finally{F(!1)}}}async function _(){if(!d)return alert("Select a PDF first");C(!0),j(null),g("Preparing...");try{const t=await d.arrayBuffer(),r=await f.getDocument({data:t}).promise,s=r.numPages;S(s),g("Rendering sample page...");const n=await r.getPage(1),c=n.getViewport({scale:P}),a=document.createElement("canvas");a.width=Math.ceil(c.width),a.height=Math.ceil(c.height);const i=a.getContext("2d");await n.render({canvasContext:i,viewport:c}).promise;const o=await new Promise(h=>a.toBlob(h,"image/jpeg",Number(v))),p=o?o.size:0,x=Math.max(0,Math.round(p*s+2e3));j(x),g("Estimated using sample page at current settings"),a.width=0,a.height=0}catch(t){console.error(t),alert("Estimate failed: "+(t.message||t))}finally{C(!1)}}async function N(t,r){const s=await d.arrayBuffer(),n=await f.getDocument({data:s}).promise,c=n.numPages,a=await n.getPage(1),i=a.getViewport({scale:r}),o=document.createElement("canvas");o.width=Math.ceil(i.width),o.height=Math.ceil(i.height);const p=o.getContext("2d");await a.render({canvasContext:p,viewport:i}).promise;const l=await new Promise(w=>o.toBlob(w,"image/jpeg",Number(t))),x=l?l.size:0,h=2e3;return o.width=0,o.height=0,Math.max(0,Math.round(x*c+h))}async function H(){if(!d)return alert("Select a PDF first");C(!0),g("Estimating range...");try{const t=await d.arrayBuffer(),s=(await f.getDocument({data:t}).promise).numPages;S(s);const n=.1,c=.5,a=1,i=1,o=Number(v),p=Number(P);g("Rendering low-quality sample...");const l=await N(n,c);g("Rendering current settings sample...");const x=await N(o,p);g("Rendering high-quality sample...");const h=await N(a,i);j({low:l,cur:x,high:h}),g("Range estimated using first-page extrapolation")}catch(t){console.error(t),alert("Range estimate failed: "+(t.message||t))}finally{C(!1)}}function b(t){return t==null?"-":t<1024?t+" B":t<1024*1024?(t/1024).toFixed(1)+" KB":(t/(1024*1024)).toFixed(2)+" MB"}return e.jsxs("div",{children:[e.jsx("h2",{children:"Compress PDF"}),e.jsxs("div",{className:`dropzone ${O?"dragover":""}`,onDragEnter:L,onDragOver:Z,onDragLeave:K,onDrop:W,children:[e.jsx("input",{type:"file",accept:"application/pdf",onChange:A}),e.jsx("div",{className:"muted",children:"Rasterize pages at lower quality/scale to reduce file size (lossy)."}),J&&e.jsx("div",{className:"drop-overlay",children:"✓ Uploaded"})]}),d&&e.jsxs("div",{style:{marginTop:12},children:[e.jsxs("div",{children:[e.jsx("strong",{children:d.name})," — ",z," pages — original: ",b(y)]}),m&&typeof m=="number"&&e.jsxs("div",{style:{marginTop:8},children:["Estimated compressed size: ",e.jsx("strong",{children:b(m)})," (",Math.round(100-m/y*100),"% smaller)"]}),m&&typeof m=="object"&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx("div",{children:"Estimated range:"}),e.jsxs("div",{style:{display:"flex",gap:12,marginTop:6},children:[e.jsxs("div",{children:["Min: ",e.jsx("strong",{children:b(m.low)})," (",Math.round(100-m.low/y*100),"% smaller)"]}),e.jsxs("div",{children:["Current: ",e.jsx("strong",{children:b(m.cur)})," (",Math.round(100-m.cur/y*100),"% smaller)"]}),e.jsxs("div",{children:["Max: ",e.jsx("strong",{children:b(m.high)})," (",Math.round(100-m.high/y*100),"% smaller)"]})]})]}),Q&&e.jsx("div",{style:{marginTop:8,color:"#6b7280"},children:Q}),e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",marginTop:8},children:[e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:["JPEG Quality:",e.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.05",value:v,onChange:t=>V(Number(t.target.value))}),e.jsxs("div",{style:{width:44,textAlign:"right"},children:[Math.round(v*100),"%"]})]}),e.jsxs("label",{style:{display:"flex",gap:8,alignItems:"center"},children:["Render Scale:",e.jsxs("select",{value:P,onChange:t=>$(Number(t.target.value)),children:[e.jsx("option",{value:1,children:"100%"}),e.jsx("option",{value:.9,children:"90%"}),e.jsx("option",{value:.8,children:"80%"}),e.jsx("option",{value:.7,children:"70%"}),e.jsx("option",{value:.6,children:"60%"}),e.jsx("option",{value:.5,children:"50%"})]})]})]}),e.jsxs("div",{style:{marginTop:12,display:"flex",gap:8},children:[e.jsx("button",{className:"btn-primary",onClick:()=>G({download:!0,preview:!1}),disabled:D,children:D?"Compressing...":"Compress & Download"}),e.jsx("button",{className:"btn-outline",onClick:()=>G({download:!1,preview:!0}),disabled:D,children:D?"Compressing...":"Preview"}),e.jsx("button",{className:"btn-ghost",onClick:_,disabled:E,children:E?"Estimating...":"Estimate size"}),e.jsx("button",{className:"btn-ghost",onClick:H,disabled:E,children:E?"Estimating...":"Estimate range (min/cur/max)"})]}),k&&e.jsxs("div",{style:{marginTop:12},children:[e.jsx("div",{className:"muted",children:"Preview (close tab/window to dismiss):"}),e.jsx("iframe",{title:"compress-preview",src:k,style:{width:"100%",height:400,border:"1px solid #ddd"}})]})]})]})}export{se as default};
